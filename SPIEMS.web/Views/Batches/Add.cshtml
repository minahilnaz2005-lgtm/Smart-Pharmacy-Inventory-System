@model SPIEMS.DAL.Entities.MedicineBatch
@using SPIEMS.DAL.Entities

<h1>➕ Add New Batch</h1>

<a asp-controller="Batches"
   asp-action="Index"
   class="btn btn-secondary">
    ← Back to Batches
</a>

<form method="post" asp-action="Add" style="max-width:600px; margin-top:20px;">
    @Html.AntiForgeryToken()

    <div>
        <label>Medicine</label>
        <select asp-for="MedicineId" required>
            <option value="">-- Select Medicine --</option>
            @{
                var meds = ViewBag.Medicines as List<Medicine> ?? new();
            }
            @foreach (var m in meds)
            {
                <option value="@m.Id">@m.GenericName</option>
            }
        </select>
    </div>

    <div style="margin-top:10px;">
        <label>Supplier (optional)</label>
        <select asp-for="SupplierId">
            <option value="">-- Select Supplier --</option>
            @{
                var suppliers = ViewBag.Suppliers as List<Supplier> ?? new();
            }
            @foreach (var s in suppliers)
            {
                <option value="@s.Id">@s.Name</option>
            }
        </select>
        <small style="display:block;color:#666;">Linking supplier enables Supplier → Batches view.</small>
    </div>

    <div style="margin-top:10px;">
        <label>Batch No</label>
        <input asp-for="BatchNo" required />
    </div>

    <div style="margin-top:10px;">
        <label>Purchase Date</label>
        <input asp-for="PurchaseDate" type="date"
               value="@Model.PurchaseDate.ToString("yyyy-MM-dd")" />
    </div>

    <div style="margin-top:10px;">
        <label>Expiry Date (optional)</label>
        <input asp-for="ExpiryDate" type="date" />
    </div>

    <div style="margin-top:10px;">
        <label>Quantity</label>
        <input asp-for="Quantity" type="number" min="1" />
    </div>

    <div style="margin-top:10px;">
        <label>Cost Price</label>
        <input asp-for="CostPrice" type="number" step="0.01" />
    </div>

    <div style="margin-top:10px;">
        <label>Sale Price</label>
        <input asp-for="SalePrice" type="number" step="0.01" />
    </div>

    <button type="submit" class="btn btn-success" style="margin-top:15px;">
        💾 Save Batch
    </button>

    @if (!ViewData.ModelState.IsValid)
    {
        <div style="background:#f8d7da;padding:10px;margin-top:10px;">
            ❌ @ViewData.ModelState.Values.First().Errors.First().ErrorMessage
        </div>
    }
</form>